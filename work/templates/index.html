{% extends 'base.html'%}
{% block title %}待办事项{% endblock %}
{% block content %}
<div class="container">
    <div class="row">
        <div class="col">
            <!-- 动态切换页面 -->
            <div id = "main"></div>
        </div>
    </div>
</div>
{% endblock %}
{% block javascript %}
    {{ super() }}
    var csrf_token = "{{ csrf_token() }}"
    var url_for_login_page = "{{ url_for('auth.login') }}"
    var url_for_todo_page = "{{ url_for('item.todo') }}"
    var url_for_intro_page = "{{ url_for('main.intro') }}"
    {#
    var url_for_new_item = "{{ url_for('item.new_item') }}"
    var url_for_clear_item = "{{ url_for('item.clear_item') }}"
    var url_for_login = "{{ url_for('auth.login') }}"
    var url_for_register = "{{ url_for('auth.register') }}"
    var url_for_logout = "{{ url_for('auth.logout') }}"
    #}
    $(function(){
        //ajax设置统一添加csrf验证
        $.ajaxSetup({
            beforeSend: function (xhr, settings) {
                if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type) && !this.crossDomain) {
                    xhr.setRequestHeader('X-CSRFToken', csrf_token);
                }
            }
        })
        //绑定hash change事件, 实现页面动态切换
        $(window).bind('hashchange', function(){
            var hash = window.location.hash.replace('#','')
            var url = null
            if(hash === 'login')
                url = url_for_login_page
            else if(hash === 'todo')
                url = url_for_todo_page
            else
                url = url_for_intro_page
            $.ajax({
                type:'get',
                url:url,
                success:function(data){
                    //显示页面
                    $('#main').hide().html(data).fadeIn(800)
                }
            })
        })
        //默认执行intro界面
        if(window.location.hash === '')
            window.location.hash = '#intro'
        else
            $(window).trigger('hashchange')
    })
    //系统路由
    function route(to){
        if(to === 'login')
            window.location.hash = '#login'
        else if(to === 'register')
            window.location.hash = '#register'
    }
{% endblock %}